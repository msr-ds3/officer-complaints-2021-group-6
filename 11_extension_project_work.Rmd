---
title: "The Correlation Between Sex and Complaints Against Police Officers"
output:
  html_notebook: default
  html_document:
    df_print: paged
---

The purpose of this project was to analyze the correlation between the sex and complaints against police officers. Analysis was done to compare the association between the sex of the complainant, the sex of the offending officer, and whether complaints by people of one sex were more likely to have their complaints sustained than people of the other sex. Analysis was also done to determine whether the sex of the officer being complained against had an effect on whether a complaint was sustained.  

All data used in this project was taken from OpenDataPhilly which contains data on complaints against police from the past five years (1/19/2016 - 3/31/21).

```{r setup}

library(tidyverse)
library(lubridate)
library(scales)
theme_set(theme_bw())

```

```{r read in data}
# read in findings data from OpenDataPhilly
philly_incidents_findings_from_open_data_philly <- 
  read_csv('data/philly_incidents_findings_from_open_data_philly.csv')
# View(philly_incidents_findings_from_open_data_philly)

# read in demographics data from OpenDataPhilly
philly_complainant_demographics_from_open_data_philly <- 
  read_csv('data/philly_complainant_demographics_from_open_data_philly.csv')
# View(philly_complainant_demographics_from_open_data_philly)

```

```{r clean data}

# select only needed columns from findings data
philly_incidents_findings_from_open_data_philly <- philly_incidents_findings_from_open_data_philly %>%
  select(complaint_id, po_sex, investigative_findings)
# View(philly_incidents_findings_from_open_data_philly)

# select only needed columns from demographics data
philly_complainant_demographics_from_open_data_philly <- 
  philly_complainant_demographics_from_open_data_philly %>%
  select(complaint_id, complainant_sex)
# View(philly_complainant_demographics_from_open_data_philly)

# join philly_incidents_findings_from_open_data_philly and philly_complainant_demographics_from_open_data_philly
philly_findings_and_demographics_from_open_data_philly <- 
  inner_join(philly_incidents_findings_from_open_data_philly, 
             philly_complainant_demographics_from_open_data_philly, 
             by = "complaint_id")
# View(philly_findings_and_demographics_from_open_data_philly)

```

First, we analyzed the percentage of complaints filed by males with a sustained finding versus the percentage of complaints filed by males with no sustained findings as compared with the percentage of complaints filed by females with a sustained finding versus the percentage of complaints filed by females with no sustained findings. As evident from the graphs below, these percentages were *nearly exactly the same* between the sexes. Therefore, the sex of the complainant does *not* seem to play a role in whether or not the findings of a complaint were sustained. 

```{r sustained and not sustained by complainant sex}

# count how many sustained findings and no sustained findings per sex
philly_findings_and_demographics_from_open_data_philly_by_sex <- 
  philly_findings_and_demographics_from_open_data_philly %>%
  filter((investigative_findings == "Sustained Finding" & complainant_sex == "male") |
           (investigative_findings == "Sustained Finding" & complainant_sex == "female") |
           (investigative_findings == "No Sustained Findings" & complainant_sex == "male") |
           (investigative_findings == "No Sustained Findings" & complainant_sex == "female")) %>%
    group_by(complainant_sex, investigative_findings) %>%
  summarize(num_in_this_category = n())
# View(philly_findings_and_demographics_from_open_data_philly_by_sex)

```

```{r graph for male complainants}

# find the proportion of complaints with sustained finding and no sustained findings
philly_findings_and_demographics_from_open_data_philly_male <- 
  philly_findings_and_demographics_from_open_data_philly_by_sex %>%
  filter(complainant_sex == "male") %>%
  mutate(proportion = num_in_this_category / sum(num_in_this_category))
# View(philly_findings_and_demographics_from_open_data_philly_male)

# bar chart
philly_findings_and_demographics_from_open_data_philly_male %>%
  ggplot(aes(x = investigative_findings, y = proportion)) +
  geom_bar(stat = "identity") +
  # label each bar with the percentage
  geom_text(aes(label = percent(proportion)), position = position_stack(vjust = 1.1)) +
  # set the y axis labels to be percents
  scale_y_continuous("Percent of All Complaints Filed by Males", labels = percent) +
  # label the x axis
  xlab("Investigative Findings") +
  # title the graph
  ggtitle("Proportion of Complaints Filed by Males 
          with a Sustained Finding vs. No Sustained Findings")

```

```{r graph for female complainants}

# find the proportion of complaints with sustained finding and no sustained findings
philly_findings_and_demographics_from_open_data_philly_female <- 
  philly_findings_and_demographics_from_open_data_philly_by_sex %>%
  filter(complainant_sex == "female") %>%
  mutate(proportion = num_in_this_category / sum(num_in_this_category))
# View(philly_findings_and_demographics_from_open_data_philly_female)

# bar chart
philly_findings_and_demographics_from_open_data_philly_female %>%
  ggplot(aes(x = investigative_findings, y = proportion)) +
  geom_bar(stat = "identity") +
  # label each bar with the percentage
  geom_text(aes(label = percent(proportion)), position = position_stack(vjust = 1.1)) +
  # set the y axis labels to be percents
  scale_y_continuous("Percent of All Complaints Filed by Females", labels = percent) +
  # label the x axis
  xlab("Investigative Findings") +
  # title the graph
  ggtitle("Proportion of Complaints Filed by Females 
          with a Sustained Finding vs. No Sustained Findings")

```

Next, we analyzed the proportion of complaints filed by people of each gender with a sustained finding versus no sustained finding depending also on the sex of the offending officer. As indicated in the table and the graphs below, these percentages were very similar between the genders. 

------          | No Sustained Findings  | Sustained Finding
--------------- | :--------------------: | :---------------------
Filed by Male   | <span style="color:blue;">75.6%</span> | <span style="color:blue;">24.4%</span>
Filed by Male   | <span style="color:red;">73.1%</span>  | <span style="color:red;">26.9%</span>
Filed by Female | <span style="color:blue;">76.0%</span> | <span style="color:blue;">24.0%</span>
Filed by Female | <span style="color:red;">73.5%</span>  | <span style="color:red;">26.5%</span>

Key:  
<span style="color:blue;">Filed against Male</span>  
<span style="color:red;">Filed against Female</span>

```{r sustained and not sustained by complainant sex and po sex}

# count how many sustained findings and no sustained findings per sex
philly_findings_and_demographics_from_open_data_philly_by_complainant_sex_and_po_sex <- 
  philly_findings_and_demographics_from_open_data_philly %>%
  group_by(complainant_sex, investigative_findings) %>%
  filter((investigative_findings == "Sustained Finding" & complainant_sex == "male") |
           (investigative_findings == "Sustained Finding" & complainant_sex == "female") |
           (investigative_findings == "No Sustained Findings" & complainant_sex == "male") |
           (investigative_findings == "No Sustained Findings" & complainant_sex == "female")) %>%
  group_by(complainant_sex, po_sex, investigative_findings) %>%
  summarize(num_in_this_category = n()) %>%
  drop_na(po_sex)
# View(philly_findings_and_demographics_from_open_data_philly_by_complainant_sex_and_po_sex)

```

```{r sustained and not sustained by male complainant by po sex}

# find proportion of complaints filed by male complainants that were sustained and not sustained by po_sex
male_complainant_and_po_sex <- 
  philly_findings_and_demographics_from_open_data_philly_by_complainant_sex_and_po_sex %>%
  # keep only male complainants
  filter(complainant_sex == "male") %>%
  # calculate the proportion
  mutate(proportion = num_in_this_category / sum(num_in_this_category))
# View(male_complainant_and_po_sex)

male_complainant_and_po_sex %>% ggplot(aes(x = investigative_findings, y = proportion, fill = po_sex)) +
  geom_bar(stat = "identity", position = "dodge") +
  # label each bar with the percentage
  geom_text(aes(label = percent(proportion)), position = position_dodge(width = 0.9), vjust = -0.5) +
  # set the y axis labels to be percents
  scale_y_continuous("Percent of Complaints Filed by Males", labels = percent) +
  # label the x axis
  xlab("Investigative Findings") +
  scale_fill_discrete("PO Sex", labels = c("Female", "Male")) +
  # title the graph
  ggtitle("Proportion of Complaints Filed by Males 
          with a Sustained Finding vs. No Sustained Findings by PO Sex")

```

```{r sustained and not sustained by female complainant by po sex}

female_complainant_and_po_sex <- 
  philly_findings_and_demographics_from_open_data_philly_by_complainant_sex_and_po_sex %>%
  # keep only female complainants
  filter(complainant_sex == "female") %>%
  # calculate the proportion
  mutate(proportion = num_in_this_category / sum(num_in_this_category))
# View(female_complainant_and_po_sex)

female_complainant_and_po_sex %>% ggplot(aes(x = investigative_findings, y = proportion, fill = po_sex)) +
  geom_bar(stat = "identity", position = "dodge") +
  # label each bar with the percentage
  geom_text(aes(label = percent(proportion)), position = position_dodge(width = 0.9), vjust = -0.5) +
  # set the y axis labels to be percents
  scale_y_continuous("Percent of Complaints Filed by Females", labels = percent) +
  # label the x axis
  xlab("Investigative Findings") +
  scale_fill_discrete("PO Sex", labels = c("Female", "Male")) +
  # title the graph
  ggtitle("Proportion of Complaints Filed by Females 
          with a Sustained Finding vs. No Sustained Findings by PO Sex")

```

















